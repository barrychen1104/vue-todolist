import{_ as B,u as F,r as i,c as $,h as M,o as c,b as u,d as e,t as w,i as r,w as b,v as N,n as L,F as O,j as D,k as C,l as E,p as P,m as j}from"./index-DxbhA9Qg.js";import{a as d}from"./axios-C8DqakIB.js";const _=p=>(P("data-v-fcbab7bf"),p=p(),j(),p),q={id:"todoListPage",class:"bg-half"},J=_(()=>e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1)),R={class:"todo_sm"},A={href:"#todolist"},G={class:"conatiner todoListPage vhContainer"},H={class:"todoList_Content"},K={class:"inputBox"},Q=_(()=>e("i",{class:"fa fa-plus"},null,-1)),W=[Q],X={class:"todoList_list"},Y={class:"todoList_tab"},Z={class:"todoList_items"},ee={class:"todoList_item"},te={class:"todoList_label"},oe=["onUpdate:modelValue","onChange"],se=["onClick"],ae=_(()=>e("i",{class:"fa fa-times"},null,-1)),le=[ae],ne={key:0,class:"todoList_empty"},ie=_(()=>e("p",null,"目前尚無待辦事項",-1)),ce=[ie],ue={key:1,class:"todoList_statistics"},re={key:0,class:"loading-overlay"},de=_(()=>e("div",{class:"loading-spinner"},null,-1)),ve=[de],v="https://todolist-api.hexschool.io",he={__name:"TodoListView",setup(p){const y=F(),l=i(""),T=i({nickname:"",uid:""}),n=i([]),f=i({content:""}),h=i("all"),o=i(!1),x=$(()=>n.value.filter(t=>!t.status).length),z=$(()=>{switch(h.value){case"all":return n.value;case"active":return n.value.filter(t=>!t.status);case"completed":return n.value.filter(t=>t.status);default:return[]}}),k=t=>{o.value||(h.value=t)},g=async()=>{try{o.value=!0;const t=await d.get(`${v}/todos/`,{headers:{authorization:l.value}});n.value=t.data.data}catch(t){console.log("err",t)}finally{o.value=!1}},V=async()=>{try{o.value=!0,await d.post(`${v}/todos/`,f.value,{headers:{authorization:l.value}}),f.value.content="",await g()}catch(t){console.log("err",t)}finally{o.value=!1}},I=async()=>{try{o.value=!0,await d.post(`${v}/users/sign_out`,null,{headers:{authorization:l.value}}),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",y.push("/")}catch(t){console.log("err",t)}finally{o.value=!1}},S=async t=>{try{o.value=!0,await d.patch(`${v}/todos/${t}/toggle`,null,{headers:{authorization:l.value}}),await g()}catch(s){console.log("err",s)}finally{o.value=!1}},U=async t=>{try{o.value=!0,await d.delete(`${v}/todos/${t}`,{headers:{authorization:l.value}}),await g()}catch(s){console.log("err",s)}finally{o.value=!1}};return M(async()=>{l.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),console.log("token",l.value),l.value||(alert("沒有token"),y.push("/"));try{o.value=!0;const t=await d.get(`${v}/users/checkout`,{headers:{authorization:l.value}});T.value=t.data,await g()}catch(t){console.log("err",t),alert("請重新登入"),y.push("/")}finally{o.value=!1}}),(t,s)=>(c(),u("div",q,[e("nav",null,[J,e("ul",null,[e("li",R,[e("a",A,[e("span",null,w(T.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"",onClick:r(I,["prevent"])},"登出")])])]),e("div",G,[e("div",H,[e("div",K,[b(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=a=>f.value.content=a),required:""},null,512),[[N,f.value.content]]),e("a",{href:"#",onClick:r(V,["prevent"])},W)]),e("div",X,[e("ul",Y,[e("li",null,[e("a",{href:"#",class:L({active:h.value==="all"}),onClick:s[1]||(s[1]=r(a=>k("all"),["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:L({active:h.value==="active"}),onClick:s[2]||(s[2]=r(a=>k("active"),["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:L({active:h.value==="completed"}),onClick:s[3]||(s[3]=r(a=>k("completed"),["prevent"]))},"已完成",2)])]),e("div",Z,[e("ul",ee,[(c(!0),u(O,null,D(z.value,a=>(c(),u("li",{key:a.id},[e("label",te,[b(e("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":m=>a.status=m,onChange:m=>S(a.id)},null,40,oe),[[E,a.status]]),e("span",null,w(a.content),1)]),e("a",{href:"#",onClick:r(m=>U(a.id),["prevent"])},le,8,se)]))),128))]),n.value.length===0?(c(),u("div",ne,ce)):C("",!0),n.value.length>0?(c(),u("div",ue,[e("p",null,w(x.value)+"個待完成項目",1)])):C("",!0)])])])]),o.value?(c(),u("div",re,ve)):C("",!0)]))}},fe=B(he,[["__scopeId","data-v-fcbab7bf"]]);export{fe as default};
